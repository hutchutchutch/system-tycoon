/* System Design Tycoon - React Flow Components v2.0 */

/* Base Node Styling */
.react-flow__node-component {
  background: var(--color-white);
  border: 2px solid var(--color-neutral-200);
  border-radius: var(--radius-lg);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
  transition: all var(--duration-normal) var(--ease-out);
  min-width: var(--node-standard-width);
  min-height: var(--node-standard-height);
}

.react-flow__node-component__header {
  display: flex;
  align-items: center;
  gap: var(--space-2);
  padding: var(--space-3) var(--space-4);
  border-bottom: 1px solid var(--color-neutral-100);
}

.react-flow__node-component__icon {
  width: 24px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: var(--radius-md);
  background: var(--color-primary-100);
  color: var(--color-primary-700);
}

.react-flow__node-component__title {
  font-size: var(--text-base);
  font-weight: var(--font-semibold);
  color: var(--color-neutral-900);
}

.react-flow__node-component__body {
  padding: var(--space-3) var(--space-4);
}

.react-flow__node-component__metrics {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: var(--space-2);
}

.react-flow__node-component__metric {
  display: flex;
  flex-direction: column;
  gap: var(--space-1);
}

.react-flow__node-component__metric-label {
  font-size: var(--text-xs);
  color: var(--color-neutral-500);
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.react-flow__node-component__metric-value {
  font-size: var(--text-base);
  font-weight: var(--font-bold);
  color: var(--color-neutral-900);
}

/* Load-based Border Styling */
.react-flow__node-component--load-low {
  border-color: var(--load-0-25);
  border-left-width: 4px;
}

.react-flow__node-component--load-medium {
  border-color: var(--load-50-75);
  border-left-width: 4px;
}

.react-flow__node-component--load-high {
  border-color: var(--load-75-90);
  border-left-width: 4px;
  animation: pulse-warning 2s ease-in-out infinite;
}

.react-flow__node-component--load-critical {
  border-color: var(--load-95-100);
  border-left-width: 4px;
  animation: shake-error 0.5s ease-in-out infinite;
}

/* Selection State */
.react-flow__node-component.selected {
  border-color: var(--color-primary-500);
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
}

/* Drag State */
.react-flow__node-component.dragging {
  cursor: grabbing;
  transform: rotate(2deg);
  box-shadow: 0 12px 32px rgba(0, 0, 0, 0.15);
}

/* Component Category Variants */
.react-flow__node-component--compute .react-flow__node-component__icon {
  background: var(--color-primary-100);
  color: var(--color-primary-700);
}

.react-flow__node-component--storage .react-flow__node-component__icon {
  background: var(--color-secondary-100);
  color: var(--color-secondary-700);
}

.react-flow__node-component--networking .react-flow__node-component__icon {
  background: var(--color-info-100);
  color: var(--color-info-700);
}

.react-flow__node-component--security .react-flow__node-component__icon {
  background: var(--color-premium-100);
  color: var(--color-premium-700);
}

.react-flow__node-component--operations .react-flow__node-component__icon {
  background: var(--color-warning-100);
  color: var(--color-warning-700);
}

/* React Flow Handle Styling */
.react-flow__handle {
  width: var(--handle-size);
  height: var(--handle-size);
  background: var(--color-neutral-400);
  border: var(--handle-border-width) solid var(--color-white);
  border-radius: 50%;
  transition: all var(--duration-fast) var(--ease-out);
}

/* Handle Types */
.react-flow__handle-source {
  background: var(--color-primary-500);
}

.react-flow__handle-target {
  background: var(--color-secondary-500);
}

/* Handle States */
.react-flow__handle:hover {
  transform: scale(var(--handle-hover-scale));
  box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.2);
}

.react-flow__handle.connecting {
  background: var(--color-warning-500);
  animation: pulse-connect 1s ease-in-out infinite;
}

.react-flow__handle.valid {
  background: var(--color-secondary-500);
  box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.3);
}

.react-flow__handle.invalid {
  background: var(--color-error-500);
  box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.3);
}

/* Multiple Handle Positioning */
.react-flow__handle--primary {
  /* Default centered position */
}

.react-flow__handle--secondary {
  top: 30%;
}

.react-flow__handle--tertiary {
  top: 70%;
}

@keyframes pulse-connect {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.2); }
}

/* React Flow Edge Styling */
.react-flow__edge-path {
  stroke: var(--color-primary-400);
  stroke-width: var(--edge-stroke-width-normal);
  fill: none;
  transition: stroke var(--duration-fast) var(--ease-out);
}

/* Traffic-based Edge Styling */
.react-flow__edge--low-traffic {
  stroke-width: var(--edge-stroke-width-normal);
  stroke: var(--connection-excellent);
}

.react-flow__edge--medium-traffic {
  stroke-width: var(--edge-stroke-width-heavy);
  stroke: var(--connection-good);
}

.react-flow__edge--high-traffic {
  stroke-width: var(--edge-stroke-width-critical);
  stroke: var(--connection-fair);
  stroke-dasharray: 5 5;
  animation: flow-animation 1s linear infinite;
}

.react-flow__edge--congested {
  stroke-width: var(--edge-stroke-width-critical);
  stroke: var(--connection-poor);
  animation: pulse-critical 0.5s ease-in-out infinite alternate;
}

/* Animated Flow Visualization */
.react-flow__edge--animated {
  stroke-dasharray: 5 5;
}

.react-flow__edge--animated path {
  animation: dash-flow 1s linear infinite;
}

@keyframes dash-flow {
  to {
    stroke-dashoffset: -10;
  }
}

@keyframes flow-animation {
  0% { stroke-dashoffset: 0; }
  100% { stroke-dashoffset: -20; }
}

/* Edge Labels */
.react-flow__edge-label {
  background: var(--color-white);
  padding: var(--space-1) var(--space-2);
  border-radius: var(--radius-sm);
  font-size: var(--text-xs);
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

/* Connection Line (Preview) */
.react-flow__connection {
  stroke: var(--design-connection-preview);
  stroke-width: 2;
  stroke-dasharray: 5 5;
  animation: dash-preview 1s linear infinite;
}

.react-flow__connection.valid {
  stroke: var(--color-secondary-400);
}

.react-flow__connection.invalid {
  stroke: var(--color-error-400);
}

@keyframes dash-preview {
  to {
    stroke-dashoffset: -10;
  }
}

/* Component Drawer */
.component-drawer {
  width: var(--canvas-sidebar-width);
  height: 100%;
  background: var(--color-neutral-50);
  border-right: 1px solid var(--color-neutral-200);
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

.component-drawer__header {
  padding: var(--space-4);
  background: var(--color-white);
  border-bottom: 1px solid var(--color-neutral-200);
}

.component-drawer__search {
  position: relative;
}

.component-drawer__search-input {
  width: 100%;
  padding: var(--space-2) var(--space-4) var(--space-2) var(--space-10);
  border: 1px solid var(--color-neutral-300);
  border-radius: var(--radius-full);
  font-size: var(--text-small);
  transition: all var(--duration-fast) var(--ease-out);
}

.component-drawer__search-icon {
  position: absolute;
  left: var(--space-3);
  top: 50%;
  transform: translateY(-50%);
  color: var(--color-neutral-400);
}

.component-drawer__categories {
  flex: 1;
  overflow-y: auto;
  padding-bottom: var(--space-4);
}

/* Category Sections */
.component-category {
  border-bottom: 1px solid var(--color-neutral-200);
}

.component-category__header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: var(--space-4);
  background: var(--color-white);
  cursor: pointer;
  transition: background var(--duration-fast) var(--ease-out);
}

.component-category__header:hover {
  background: var(--color-neutral-50);
}

.component-category__icon {
  width: 24px;
  height: 24px;
  margin-right: var(--space-3);
}

.component-category__title {
  flex: 1;
  font-size: var(--text-base);
  font-weight: var(--font-semibold);
  color: var(--color-neutral-900);
}

.component-category__count {
  padding: var(--space-1) var(--space-2);
  background: var(--color-neutral-100);
  color: var(--color-neutral-600);
  border-radius: var(--radius-full);
  font-size: var(--text-xs);
  font-weight: var(--font-medium);
}

.component-category__chevron {
  transition: transform var(--duration-fast) var(--ease-out);
}

.component-category--expanded .component-category__chevron {
  transform: rotate(180deg);
}

.component-category__items {
  padding: var(--space-2);
  display: grid;
  gap: var(--space-2);
  max-height: 0;
  overflow: hidden;
  transition: max-height var(--duration-normal) var(--ease-out);
}

.component-category--expanded .component-category__items {
  max-height: 600px;
}

/* Draggable Component Items */
.component-item {
  display: flex;
  align-items: center;
  gap: var(--space-3);
  padding: var(--space-3);
  background: var(--color-white);
  border: 1px solid var(--color-neutral-200);
  border-radius: var(--radius-md);
  cursor: grab;
  transition: all var(--duration-fast) var(--ease-out);
  position: relative;
}

.component-item__icon {
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: var(--radius-sm);
  background: var(--color-primary-100);
  color: var(--color-primary-700);
  flex-shrink: 0;
}

.component-item__content {
  flex: 1;
  min-width: 0;
}

.component-item__name {
  font-size: var(--text-base);
  font-weight: var(--font-medium);
  color: var(--color-neutral-900);
  margin-bottom: var(--space-1);
}

.component-item__cost {
  font-size: var(--text-xs);
  color: var(--color-neutral-600);
}

.component-item__badge {
  position: absolute;
  top: -4px;
  right: -4px;
  padding: 2px 6px;
  background: var(--color-primary-500);
  color: white;
  border-radius: var(--radius-full);
  font-size: 10px;
  font-weight: var(--font-bold);
  text-transform: uppercase;
}

.component-item:hover {
  background: var(--color-primary-50);
  border-color: var(--color-primary-300);
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

.component-item:active {
  cursor: grabbing;
  transform: scale(0.98);
}

.component-item--dragging {
  opacity: 0.5;
  cursor: grabbing;
}

.component-item--locked {
  opacity: 0.6;
  cursor: not-allowed;
  background: var(--color-neutral-100);
}

.component-item--locked:hover {
  transform: none;
  box-shadow: none;
  border-color: var(--color-neutral-200);
}

.component-item__lock-icon {
  position: absolute;
  right: var(--space-3);
  color: var(--color-neutral-400);
}

/* React Flow Controls */
.react-flow__controls {
  background: var(--color-white);
  border: 1px solid var(--color-neutral-200);
  border-radius: var(--radius-lg);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  overflow: hidden;
}

.react-flow__controls-button {
  width: 36px;
  height: 36px;
  background: var(--color-white);
  border: none;
  border-bottom: 1px solid var(--color-neutral-200);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all var(--duration-fast) var(--ease-out);
}

.react-flow__controls-button:last-child {
  border-bottom: none;
}

.react-flow__controls-button:hover {
  background: var(--color-primary-50);
  color: var(--color-primary-700);
}

.react-flow__controls-button:active {
  transform: scale(0.95);
}

.react-flow__controls-button svg {
  width: 18px;
  height: 18px;
}

/* React Flow Background */
.react-flow__background {
  background-color: var(--design-canvas-bg);
}

.react-flow__background pattern .react-flow__background-path {
  stroke: var(--design-grid-line);
  stroke-width: 0.5;
}

/* Dots Pattern */
.react-flow__background-pattern--dots circle {
  fill: var(--design-grid-dot);
}

/* Lines Pattern */
.react-flow__background-pattern--lines path {
  stroke: var(--design-grid-line);
}

/* Cross Pattern */
.react-flow__background-pattern--cross path {
  stroke: var(--design-grid-line);
  stroke-width: 0.3;
}

/* MiniMap Customization */
.react-flow__minimap {
  background: var(--color-neutral-100);
  border: 1px solid var(--color-neutral-300);
  border-radius: var(--radius-lg);
  overflow: hidden;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.react-flow__minimap-mask {
  fill: var(--color-neutral-200);
  opacity: 0.3;
}

.react-flow__minimap-node {
  fill: var(--color-primary-400);
  stroke: var(--color-primary-600);
  stroke-width: 1;
}

.react-flow__minimap-node--compute {
  fill: var(--color-primary-400);
}

.react-flow__minimap-node--storage {
  fill: var(--color-secondary-400);
}

.react-flow__minimap-node--networking {
  fill: var(--color-info-400);
}

.react-flow__minimap-node--security {
  fill: var(--color-premium-400);
}

.react-flow__minimap-node--operations {
  fill: var(--color-warning-400);
}

/* Data Packet Animation */
.data-packet {
  position: absolute;
  width: 12px;
  height: 12px;
  background: var(--sim-packet-color);
  border-radius: 50%;
  box-shadow: 0 0 8px var(--sim-packet-glow);
  pointer-events: none;
  z-index: 5;
}

.data-packet--http {
  background: var(--color-primary-500);
  box-shadow: 0 0 8px rgba(59, 130, 246, 0.6);
}

.data-packet--database {
  background: var(--color-secondary-500);
  box-shadow: 0 0 8px rgba(34, 197, 94, 0.6);
}

.data-packet--cache {
  background: var(--color-warning-500);
  box-shadow: 0 0 8px rgba(249, 115, 22, 0.6);
}

.data-packet--error {
  background: var(--color-error-500);
  box-shadow: 0 0 8px rgba(239, 68, 68, 0.6);
  animation: pulse-error 0.3s ease-in-out infinite;
}

@keyframes pulse-error {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.2); }
}

/* Packet Trail Effect */
.data-packet::before {
  content: '';
  position: absolute;
  inset: -2px;
  background: inherit;
  border-radius: 50%;
  opacity: 0.3;
  animation: packet-trail 0.5s ease-out;
}

@keyframes packet-trail {
  0% { transform: scale(1); opacity: 0.5; }
  100% { transform: scale(2); opacity: 0; }
}